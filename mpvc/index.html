<!DOCTYPE html>
<html lang="en">
<head>
    <title>gmt4.github.io/mpvc</title>
    <link rel="canonical" href="https://gmt4.github.io/mpvc">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="gmt4" />
    <meta name="description" content="gmt4 mpvc fork" />
    <!-- Open Graph tags -->
    <meta property="og:site_name" content="gmt4.github.io/mpvc" />
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="gmt4.github.io/mpvc"/>
    <meta property="og:url" content="https://gmt4.github.io/mpvc"/>
    <meta property="og:description" content="gmt4 mpvc fork"/>
    <meta property="og:image" content="https://raw.githubusercontent.com/gmt4/mpvc/master/docs/mpvc-tui.png"/>

    <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>

<html>
<body>
    <h1 id="gmt4-mpvc-fork">@gmt4 mpvc fork</h1>
    <ul>
        <li><strong>about</strong> A minimal mpc CLI and TUI for controlling mpv.</li>
        <li><strong>tags</strong> cli music-player terminal minimal mpv tui media-player mplayer posix-sh mpv-player mpvc mpvc-tui</li>
        <li><strong>goodies</strong> Support for TUI, CLI, manage/play URLs to youtube and other music streaming services (<a href="#logbook-20221219">See #20221219</a>)</li>
        <li><strong>github</strong> <a href="https://github.com/gmt4/mpvc/">https://github.com/gmt4/mpvc/</a></li>
        <li><strong>wiki</strong> <a href="https://github.com/gmt4/mpvc/wiki">https://github.com/gmt4/mpvc/wiki/</a></li>
        <li><strong>discussions</strong> <a href="https://github.com/gmt4/mpvc/discussions">https://github.com/gmt4/mpvc/discussions/</a></li>
        <li><strong>promote</strong>
            star, share, and promote our work through the buttons below if you find it useful.
    </ul>

    <a class="github-button" href="https://github.com/gmt4/mpvc" data-icon="octicon-star" aria-label="Star gmt4/mpvc on GitHub">Star</a>
    <a class="github-button" href="https://github.com/gmt4" aria-label="Follow @gmt4 on GitHub">Follow @gmt4</a>
<a class="github-button" href="https://github.com/gmt4/mpvc/archive/HEAD.zip" data-icon="octicon-download" aria-label="Download gmt4/mpvc on GitHub">Download</a>
    <a class="github-button" href="https://github.com/gmt4/mpvc/subscription" data-icon="octicon-eye" aria-label="Watch gmt4/mpvc on GitHub">Watch</a>
<a class="github-button" href="https://github.com/buttons/github-buttons/discussions" data-icon="octicon-comment-discussion" aria-label="Discuss buttons/github-buttons on GitHub">Discuss</a>
    <a href="https://github.com/gmt4/mpvc" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <hr/>
    <h2 id="gmt4-mpvc-fork">mpvc screenshots</h2>
    <p>
        <a href="https://github.com/gmt4/mpvc/">
            <img src="https://github.com/gmt4/mpvc/raw/master/docs/mpvc-tui.png" alt="mpvc-tui screenshot" />
        </a>
        <a href="https://github.com/gmt4/mpvc/">
            <img src="https://github.com/gmt4/mpvc/raw/master/docs/mpvc-tui-arch.png" alt="mpvc-tui arch screenshot" />
        </a>
    </p>

    <hr/>
    <h2 id="gmt4-mpvc-quickstart">mpvc quickstart</h2>

    <pre>
git clone https://github.com/gmt4/mpvc/
mpvc/mpvc add /path/to/your/*.mp3 # or your URLs
mpvc/mpvc-tui
# to install just copy/link to your $HOME/bin
make -C mpvc link BINDIR=$HOME/bin
    </pre>

    <hr/>
    <h2 id="gmt4-mpvc-logbook">mpvc logbook</h2>

    The logbook below is just that, a log of notes as I use and work  on mpvc-tui.
    Entries are chronologically ordered with oldest first, and, attempt to be self-contained focused on a certain functionality/topic, to the extent that it is possible.

    <h3  id="logbook-20220330">On playing URLs, Wed 30 Mar 2022 ✓</h3>
    <p>
    What got me started on using mpvc is being able to play URLs. This is the cause to start writing what you are reading now (this repo at https://github.com/gmt4/mpvc/)
    </p>

    <h3 id="logbook-20221114">On securing mpv socket location, Mon 14 Nov 2022 ✓</h3>
    <p>
    One thing that bothers me when using mpvc, is that most programs performing ipc on mpv socket, just leave the socket at /tmp/mpvsocket. A better default location for the mpv socket is $HOME/.config/mpvc/mpvsocket
    </p>

    <h3 id="logbook-20221118">On load/save functionality, Fri 18 Nov 2022 ✓</h3>
    <p>
    A thing that I'd like to be able to do is to perform mpvc load/save of the playlist, and, be able of manipulating the playlist using standard Unix commands eg. grep. The easiest way that comes to mind, is something a la: mpvc save | grep -v artist | mpvc load. This enables to filter out an artist, and drop all the songs by this artist.
    </p>

    <h3 id="logbook-20221120">On persistent mpv startup, Sun 20 Nov 2022 ✓</h3>
    <p>
    One particular feature where improvement could be done mpvc -a audio.opus, when mpv finishes playing audio.opus, mpv terminates, and, the current playlist is lost. This happens as mpv is started with --idle=once. A solution for this is to start mpv separately with --idle=yes. A shortcut for this is to run `mpvc --mpv` that does exactly this, after this the mpv instance can be manipulated with mpvc, and does not terminate once mpv finishes playing.
    </p>

    <h3 id="logbook-20221203">On a minimal mpvc-tui, Sat 03 Dec 2022 ✓</h3>
    <p>
    One thing I keep doing a lot, is typing mpvc status and mpvc -i, to check the mpv playlist and status. To this end I've quickly hacked a minimal TUI https://github.com/gmt4/mpvc/blob/master/mpvc-tui, that continuously shows the mpvc playlist & status. In addition, while in mpvc-tui you can Control+C, to get a mpvc prompt to run quick mpvc commands, like: prev, next, pause, toggle, seek, volume, etc.
    </p>

    <h3 id="logbook-20221213">On using the mpvc-tui prompt, Wednesday 13 Dec 2022 ✓</h3>
    <p>
    As explained above, mpvc-tui does three things: 1) display status, 2) display playlist, 3) prompt the user for interaction.

    Once we hit Control+C, and land on the user prompt, the following can be done:
    <ol>
    <li> run mpvc commands starting with "mpvc". This allows for manipulating the mpv/mpvc status. The commands run with "mpvc" have QUIETFLAG=true set, to not clutter the mpvc-tui.
    <li> run shell commands internally starting with "!". This allows for commands that manipulate mpvc-tui program, such as changing the working directory, with cd/pwd. This also allows for starting your favorite editor to configure the mpvc-tui look and feel with: "!$EDITOR $MPVC_CONFIG".
    <li> run shell commands externally starting with "!!". This allows for running commands on a separate shell. This gives room for more complex commands, like starting alsamixer to manipulate audio levels, change outputs with `pactl(1)`, etc.
    <li> quit the mpvc-tui, by typing quit, exit, or "q".
    </ol>

    When using the mpvc-tui prompt for some time, one notices that there's a lot of repetition of commands. To address repetition, one solution is to use a history file of past commands, and completion of commands & filenames. This can be achieved using `rlwrap(1)` in one shot mode that becomes a life-saver. Now, you get a more comfortable prompt, where TAB completion works on commands and filenames, as well as Control+R to repeat previous commands in the history file.
    </p>

    <h3 id="logbook-20221214">On using the mpvc-tui -x launcher, Thursday 14 Dec 2022 ✓</h3>
    <p>
    Another nifty detail of mpvc-tui, is that it can be quickly spawn from the WM launcher by using `mpvc-tui -x`, then type a few mpvc commands to setup music, and close it. Or it can be started on the current terminal with `mpvc-tui` and left running as a long running program, and get back to it when needed.
    </p>

    <h3 id="logbook-20221215">On managing playlists with mpvc autoload/autosave, Thursday 15 Dec 2022 ✓</h3>
    <p>
    When using `mpc(1)`, playlists can be managed using the mpc load/save/lsplaylists commands.

    In addition to load/save, mpvc adds the autoload/autosave commands:
    <ul>
    <li> mpvc autosave: save the current playlist to $XDG_CONFIG_HOME/mpvc/playlist/.
         If no arguments are provided the current playlist is named "$(date -Imin)".
         Otherwise, if a name is given "mpvc autosave ambient.m3u", then the file is saved as "ambient.m3u"
    <li> mpvc autoload: loads the named playlist from $XDG_CONFIG_HOME/mpvc/playlist/.
    <li> mpvc lsplaylists: list the playlists under $XDG_CONFIG_HOME/mpvc/playlist/.
    </ul>

    The above enables to arrange a playlist, and once we are happy with it, save it with `mpvc autosave playlist.m3u`, later, we can replay it again with: `mpvc autoload playlist.m3u`.
    </p>

    <h3 id="logbook-20221216">On customizing mpvc-tui look and feel, Friday 16 Dec 2022 ✓</h3>
    <p>
    While using mpvc-tui, one ends up wanting to configure the minimal look and feel that mpvc-tui provides. To this end the file mpvc-tui.conf under $XDG_CONFIG_HOME/mpvc/ provides a place to overwrite the look and feel default settings of mvpc-tui.
    </p>

    <h3>Show HN: mpvc-tui, A minimal mpc-like cli and tui for mpv., Friday 16 Dec 2022 ✓</h3>
    <p>
    We are on "Show HN"! <a href="https://news.ycombinator.com/item?id=34013149">https://news.ycombinator.com/item?id=34013149</a>
    </p>

    <h3 id="logbook-20221217">On issuing direct JSON IPC commands to mpv, Saturday 17 Dec 2022 ✓</h3>
    <p>
    That one is easy, for that purpose "mpvc cmd args" sends the "command": args to the JSON IPC. Some usage examples to test are:
    <ul>
        <li> mpvc cmd show-text "hello-world" 2000
        <li> mpvc cmd af toggle lavfi=[loudnorm=I=-16:TP=-3:LRA=4]
        <li> mpvc cmd af toggle lavfi=[dynaudnorm=g=5:f=250:r=0.9:p=0.5]
    </ul>
    Note, audio filter commands above are lifted from https://github.com/mpv-player/mpv/issues/6210.
    </p>

    <h3 id="logbook-20221219">On playing music from streaming services as youtube & co., Monday 19 Dec 2022 ✓</h3>
    <p>
    Mpv already plays URLs (both video and audio) from streaming platforms as youtube & co. So the one thing missing is to be able to search, select, and enqueue music from these services. This is provided by mpvc-tui -s/-p, that does:
    <ol>
        <li>Query the Invidious API and return a list of URLs
        <li>Use fzf -m to select from the search results.
        <li>Use mpvc load to enqueue the selected songs into the mpv playlist.
    </ol>
    Some usage examples of the above are:
    <ul>
        <li> mpvc-tui -s rolling stones: <b>Search</b> and return the list of URLs found.
        <li> mpvc-tui -s rolling stones | fzf -m: <b>Search, Select</b> and return the list of URLs selected.
        <li> mpvc-tui -s rolling stones | fzf -m | awk '{print $1}' | mpvc load: <b>Search, Select, Enqueue</b> and play the list of URLs selected.
        <li> mpvc-tui -p rolling stones: Is a shortcut of the last command that does the whole thing.
    </ul>
    Note, that you can use this command from inside mpvc-tui too, by hitting Control+C and then typing "!mpvc-tui -p rolling stones"
    </p>

    <h3 id="logbook-20221221">On subscribing and receiving mpv events , Wednesday 21 Dec 2022 ✓</h3>
    <p>
    Mpv IPC JSON socket allows receiving the media events generated by the running mpv instance.
    Subscribing to the mpv events can be done using the command: mpvc idleloop, by default events appear on standard output for a separate program to consume and react them.
    Some usage examples of the above are:
    <ul>
        <li> mpvc idleloop: send the mpv events to stdout.
        <li> mpvc idleloop | awk '/tracks-changed/ {print}': select only the "tracks-changed" mpv events.
        <li> mpvc idleloop | awk '/tracks-changed/ {system("notify-send -u normal -i dialog-warning \"$(mpvc)\"");print}': Send a notification when the track changes.
    </ul>
    </p>

</body>
</html>
